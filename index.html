<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spaarkring - Secure</title>
    
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
    <script>
      window.OneSignalDeferred = window.OneSignalDeferred || [];
      OneSignalDeferred.push(async function(OneSignal) {
        await OneSignal.init({
          appId: "564eb270-ccb3-428f-b9f8-f162d56321c4",
        });
      });
    </script>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f4f8; padding: 10px; text-align: center; }
        .container { max-width: 100%; margin: auto; background: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); border-top: 8px solid #1a73e8; }
        h1 { color: #1a73e8; text-transform: uppercase; margin-bottom: 15px; font-size: 2.2em; }
        
        .payment-notice { 
            background-color: #e8f0fe; 
            border: 1px solid #1a73e8; 
            color: #1a73e8; 
            padding: 15px; 
            border-radius: 12px; 
            margin-bottom: 20px; 
            font-weight: bold; 
            line-height: 1.6;
        }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; table-layout: fixed; }
        th, td { padding: 12px 5px; border-bottom: 1px solid #eee; text-align: center; font-size: 0.95em; }
        th { background: #f8f9fa; color: #555; }
        .paid { color: #28a745; font-weight: bold; background: #e6ffed; padding: 6px 10px; border-radius: 12px; display: inline-block; }
        .not-paid { color: #dc3545; font-weight: bold; background: #ffeef0; padding: 6px 10px; border-radius: 12px; display: inline-block; }
        .received-status { color: #1a73e8; font-weight: bold; background: #e8f0fe; padding: 6px 10px; border-radius: 12px; display: inline-block; }
        
        input { width: 60px; padding: 6px; border: 1px solid #ddd; border-radius: 5px; text-align: center; }
        button { background: #34a853; color: white; border: none; padding: 7px 12px; border-radius: 5px; cursor: pointer; }
        
        .footer-notice { margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 15px; border: 2px dashed #1a73e8; }
        .highlight { color: #1a73e8; font-size: 1.2em; font-weight: bold; display: block; margin-bottom: 15px; }

        #customAlert { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 25px; border-radius: 15px; box-shadow: 0 0 30px rgba(0,0,0,0.3); z-index: 1000; width: 85%; max-width: 320px; }
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; }
        .close-btn { background: #1a73e8; color: white; border: none; padding: 8px 20px; border-radius: 5px; margin-top: 15px; cursor: pointer; width: 100%; }
        
        @media screen and (max-width: 600px) {
            th, td { font-size: 0.8em; padding: 8px 2px; }
            .container { padding: 10px; }
            h1 { font-size: 1.8em; }
        }
    </style>
</head>
<body>
    <div id="overlay"></div>
    <div id="customAlert">
        <p id="alertMessage" style="font-weight: bold; font-size: 1.1em;"></p>
        <button class="close-btn" onclick="closeAlert()">Ù…ÙˆØ§ÙÙ‚</button>
    </div>

    <div class="container">
        <h1>Spaarkring</h1>
        <div class="payment-notice">
            ğŸ“¢ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: 400 ÙŠÙˆØ±Ùˆ <br>
            ğŸ“… Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø¯ÙØ¹: 22 Ù…Ù† ÙƒÙ„ Ø´Ù‡Ø±
        </div>
        
        <h3>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</h3>
        <table>
            <thead>
                <tr>
                    <th style="width: 25%;">Ø§Ù„Ø§Ø³Ù…</th>
                    <th style="width: 25%;">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th style="width: 25%;">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                    <th style="width: 25%;">ØªØ£ÙƒÙŠØ¯</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>

        <div class="footer-notice">
            <span class="highlight">ğŸ’° ÙŠØ³ØªÙ„Ù… ÙƒÙ„ Ø¹Ø¶Ùˆ Ù…Ø¨Ù„Øº: 4000 ÙŠÙˆØ±Ùˆ</span>
            <h3>Ø¬Ø¯ÙˆÙ„ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„ÙƒÙ„ÙŠØ©</h3>
            <table>
                <thead>
                    <tr>
                        <th style="width: 50%;">Ø§Ù„Ø§Ø³Ù…</th>
                        <th style="width: 50%;">Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</th>
                    </tr>
                </thead>
                <tbody id="receivedTableBody"></tbody>
            </table>
        </div>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyC-J-Cg9OeZD--fwStoZTFzK4qU4v170M",
        authDomain: "jamia-app-5bd27.firebaseapp.com",
        databaseURL: "https://jamia-app-5bd27-default-rtdb.europe-west1.firebasedatabase.app/",
        projectId: "jamia-app-5bd27",
        storageBucket: "jamia-app-5bd27.appspot.com",
        messagingSenderId: "870308712173",
        appId: "1:870308712173:web:be101df99fef2085b344a2"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø¯Ø«Ø© Ø¨Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    const members = [
        { id: 1, name: "Ù…Ø­Ø³Ù†" }, { id: 2, name: "Ø³Ù„ÙŠÙ…" }, { id: 3, name: "Ø£Ø¨Ùˆ Ù…Ø­Ù…Ø¯" },
        { id: 4, name: "Ù…Ø´ØªØ§Ù‚" }, { id: 5, name: "Ø±Ø¶ÙˆØ§Ù†" }, { id: 6, name: "Ø­Ù…Ø²Ù‡" },
        { id: 7, name: "Ø¹Ù„ÙŠ" }, { id: 8, name: "Ø£Ø¨Ùˆ Ù‡ØªØ§Ù†" }, { id: 9, name: "Ø£Ø¨Ùˆ Ø®Ø§Ù„Ø¯" },
        { id: 10, name: "Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù†" }
    ];

    function showAlert(msg) {
        document.getElementById('alertMessage').innerText = msg;
        document.getElementById('customAlert').style.display = 'block';
        document.getElementById('overlay').style.display = 'block';
    }
    function closeAlert() {
        document.getElementById('customAlert').style.display = 'none';
        document.getElementById('overlay').style.display = 'none';
    }

    function renderTables(data) {
        const paidStatus = data.payments || {};
        const receivedStatus = data.received_totals || {};
        
        // 1. Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
        const tableBody = document.getElementById('tableBody');
        tableBody.innerHTML = '';
        members.forEach(member => {
            const isPaid = paidStatus[member.id]?.status === true;
            const payDate = isPaid ? paidStatus[member.id].date : '-';
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td><strong>${member.name}</strong></td>
                <td><span class="${isPaid ? 'paid' : 'not-paid'}">${isPaid ? 'âœ…' : 'âŒ'}</span></td>
                <td>${payDate}</td>
                <td>
                    ${isPaid ? 'âœ”ï¸' : `
                    <input type="password" id="code-${member.id}" placeholder="***">
                    <button onclick="checkSecretCode(${member.id})">OK</button>`}
                </td>
            `;
            tableBody.appendChild(tr);
        });

        // 2. Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… (Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„)
        const receivedBody = document.getElementById('receivedTableBody');
        receivedBody.innerHTML = '';
        members.forEach(member => {
            const hasReceived = receivedStatus[member.id] === true;
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td><strong>${member.name}</strong></td>
                <td><span class="${hasReceived ? 'received-status' : 'not-paid'}">${hasReceived ? 'ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…' : 'Ù„Ù… ÙŠØ³ØªÙ„Ù… Ø¨Ø¹Ø¯'}</span></td>
            `;
            receivedBody.appendChild(tr);
        });
    }

    // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    db.ref().on('value', snapshot => {
        renderTables(snapshot.val() || {});
    });

    function checkSecretCode(memberId) {
        const inputField = document.getElementById('code-' + memberId);
        const inputCode = inputField.value.trim();
        if (!inputCode) { showAlert('âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯'); return; }

        db.ref('secret_codes/' + memberId).once('value').then(snapshot => {
            const secretCode = snapshot.val();
            if (secretCode !== null && String(inputCode) === String(secretCode)) {
                const now = new Date();
                const dateStr = now.toLocaleDateString('en-GB');
                db.ref('payments/' + memberId).set({ status: true, date: dateStr });
                showAlert('âœ… ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ù†Ø¬Ø§Ø­!');
            } else {
                showAlert('âŒ Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­!');
                inputField.value = '';
            }
        });
    }
</script>
</body>
</html>
