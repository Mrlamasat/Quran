<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spaarkring - Secure</title>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<style>
    body { font-family: 'Segoe UI', sans-serif; background-color: #f0f4f8; padding: 10px; text-align: center; }
    .container { max-width: 100%; margin: auto; background: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); border-top: 8px solid #1a73e8; }
    h1 { color: #1a73e8; text-transform: uppercase; margin-bottom: 15px; font-size: 2em; letter-spacing: 1px; }
    .payment-notice { background-color: #e8f0fe; border: 1px solid #1a73e8; color: #1a73e8; padding: 12px; border-radius: 10px; margin-bottom: 20px; font-weight: bold; font-size: 1em; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; table-layout: fixed; word-wrap: break-word; }
    th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: center; font-size: 1em; }
    th { background: #f8f9fa; color: #555; }
    .paid { color: #28a745; font-weight: bold; background: #e6ffed; padding: 8px 12px; border-radius: 15px; display: inline-block; font-size: 0.9em; }
    .not-paid { color: #dc3545; font-weight: bold; background: #ffeef0; padding: 8px 12px; border-radius: 15px; display: inline-block; font-size: 0.9em; }
    input { width: 70px; padding: 6px; border: 1px solid #ddd; border-radius: 5px; text-align: center; font-size: 0.9em; }
    button { background: #34a853; color: white; border: none; padding: 6px 10px; border-radius: 5px; cursor: pointer; transition: 0.3s; font-size: 0.9em; }
    button:hover { background: #2d8e47; }
    #customAlert { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 15px; box-shadow: 0 0 20px rgba(0,0,0,0.3); z-index: 1000; width: 80%; max-width: 300px; }
    #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; }
    .close-btn { background: #1a73e8; color: white; border: none; padding: 5px 15px; border-radius: 5px; margin-top: 10px; cursor: pointer; }
    @media screen and (max-width: 600px) {
        th, td { font-size: 0.85em; padding: 6px; }
        input { width: 60px; font-size: 0.8em; }
        button { padding: 5px 8px; font-size: 0.8em; }
        .paid, .not-paid { font-size: 0.8em; padding: 5px 8px; }
    }
</style>
</head>
<body><div id="overlay"></div>
<div id="customAlert">
    <p id="alertMessage"></p>
    <button class="close-btn" onclick="closeAlert()">Ù…ÙˆØ§ÙÙ‚</button>
</div><div class="container">
    <h1>Spaarkring</h1>
    <div class="payment-notice">
        ğŸ“¢ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: 400 ÙŠÙˆØ±Ùˆ <br>
        ğŸ“… Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø¯ÙØ¹: 22 Ù…Ù† ÙƒÙ„ Ø´Ù‡Ø±
    </div>
    <table>
        <thead>
            <tr>
                <th>Ø§Ù„Ø§Ø³Ù…</th>
                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹</th>
                <th>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
</div><script>
const firebaseConfig = {
    apiKey: "AIzaSyC-J-Cg9OeZD--fwStoZTFzK4qU4v170M",
    authDomain: "jamia-app-5bd27.firebaseapp.com",
    databaseURL: "https://jamia-app-5bd27-default-rtdb.europe-west1.firebasedatabase.app/",
    projectId: "jamia-app-5bd27",
    storageBucket: "jamia-app-5bd27.appspot.com",
    messagingSenderId: "870308712173",
    appId: "1:870308712173:web:be101df99fef2085b344a2"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const members = [
    { id: 1, name: "Ù…Ø­Ø³Ù†" }, { id: 2, name: "Ø³Ù„ÙŠÙ…" }, { id: 3, name: "Ø£Ø¨Ùˆ Ù…Ø­Ù…Ø¯" },
    { id: 4, name: "Ù…Ø´ØªØ§Ù‚" }, { id: 5, name: "Ø±Ø¶ÙˆØ§Ù†" }, { id: 6, name: "Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù†" },
    { id: 7, name: "Ø¹Ù„ÙŠ" }, { id: 8, name: "Ø£Ø¨Ùˆ Ù‡ØªØ§Ù†" }, { id: 9, name: "Ø£Ø¨Ùˆ Ø®Ø§Ù„Ø¯" },
    { id: 10, name: "Ø­Ù…Ø²Ø©" }
];

function showAlert(msg) {
    document.getElementById('alertMessage').innerText = msg;
    document.getElementById('customAlert').style.display = 'block';
    document.getElementById('overlay').style.display = 'block';
}
function closeAlert() {
    document.getElementById('customAlert').style.display = 'none';
    document.getElementById('overlay').style.display = 'none';
}

function renderTable(paidStatus) {
    const tableBody = document.getElementById('tableBody');
    tableBody.innerHTML = '';
    const fragment = document.createDocumentFragment();

    members.forEach(member => {
        const tr = document.createElement('tr');
        const isPaid = paidStatus[member.id]?.status === true;
        const payDate = isPaid ? paidStatus[member.id].date : '-';
        tr.setAttribute('data-id', member.id);
        tr.innerHTML = `
            <td><strong>${member.name}</strong></td>
            <td><span class="${isPaid ? 'paid' : 'not-paid'}">${isPaid ? 'âœ… ØªÙ… Ø§Ù„Ø¯ÙØ¹' : 'âŒ Ù„Ù… ÙŠØ¯ÙØ¹'}</span></td>
            <td>${payDate}</td>
            <td>
                ${isPaid ? 'âœ”ï¸ Ù…ÙƒØªÙ…Ù„' : `
                <input type="password" id="code-${member.id}" placeholder="Ø§Ù„ÙƒÙˆØ¯">
                <button data-id="${member.id}">ØªØ£ÙƒÙŠØ¯</button>`}
            </td>
        `;
        fragment.appendChild(tr);
    });

    tableBody.appendChild(fragment);

    document.querySelectorAll('button[data-id]').forEach(btn => {
        const memberId = btn.getAttribute('data-id');
        btn.addEventListener('click', () => checkSecretCode(memberId));
        const inputField = document.getElementById('code-' + memberId);
        inputField.addEventListener('keyup', (e) => { if (e.key === 'Enter') checkSecretCode(memberId); });
    });
}

db.ref('payments').on('value', snapshot => {
    const paidStatus = snapshot.val() || {};
    renderTable(paidStatus);
});

function checkSecretCode(memberId) {
    const inputField = document.getElementById('code-' + memberId);
    const inputCode = inputField.value.trim();
    if (!inputCode) { showAlert('âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯'); return; }

    db.ref('secret_codes/' + memberId).once('value').then(snapshot => {
        const secretCode = snapshot.val();
        if (secretCode !== null && String(inputCode) === String(secretCode)) {
            const now = new Date();
            const dateStr = now.toLocaleDateString('ar-EG');
            db.ref('payments/' + memberId).set({ status: true, date: dateStr });
            showAlert('âœ… ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ù†Ø¬Ø§Ø­!');
        } else {
            showAlert('âŒ Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­! ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø±Ù‚Ù….');
            inputField.value = '';
        }
    });
}
</script></body>
</html>
