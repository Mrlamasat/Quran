<script>
    const firebaseConfig = {
        apiKey: "YOUR_KEY",
        authDomain: "YOUR_DOMAIN",
        databaseURL: "YOUR_DB_URL",
        projectId: "YOUR_ID",
        storageBucket: "YOUR_BUCKET",
        messagingSenderId: "YOUR_MSG_ID",
        appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const members = [
        { id: 1, name: "محسن" }, { id: 2, name: "سليم" }, { id: 3, name: "أبو محمد" },
        { id: 4, name: "مشتاق" }, { id: 5, name: "رضوان" }, { id: 6, name: "عبدالرحمن" },
        { id: 7, name: "علي" }, { id: 8, name: "أبو هتان" }, { id: 9, name: "أبو خالد" },
        { id: 10, name: "حمزة" }
    ];

    function getCurrentMonthKey() {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        return `${year}-${month}`;
    }

    function showAlert(msg) {
        document.getElementById('alertMessage').innerText = msg;
        document.getElementById('customAlert').style.display = 'block';
        document.getElementById('overlay').style.display = 'block';
    }

    function closeAlert() {
        document.getElementById('customAlert').style.display = 'none';
        document.getElementById('overlay').style.display = 'none';
    }

    function renderTable(paidStatus) {
        const tableBody = document.getElementById('tableBody');
        tableBody.innerHTML = '';

        members.forEach(member => {
            const isPaid = paidStatus[member.id]?.status === true;
            const payDate = isPaid ? paidStatus[member.id].date : '-';

            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td><strong>${member.name}</strong></td>
                <td>
                    <span class="${isPaid ? 'paid' : 'not-paid'}">
                        ${isPaid ? 'مدفوع' : 'غير مدفوع'}
                    </span>
                </td>
                <td>${payDate}</td>
                <td>
                    ${isPaid ? '✔️' : `
                        <input type="password" id="code-${member.id}" placeholder="***">
                        <button onclick="submitCode(${member.id})">تأكيد</button>
                    `}
                </td>
            `;
            tableBody.appendChild(tr);
        });
    }

    function submitCode(memberId) {
        const input = document.getElementById('code-' + memberId);
        const code = input.value.trim();

        if (!code) {
            showAlert("❌ أدخل الكود");
            return;
        }

        const monthKey = getCurrentMonthKey();
        const now = new Date();
        const dateStr = now.toLocaleDateString('ar-EG');

        db.ref(`payments/${monthKey}/${memberId}`).set({
            status: true,
            date: dateStr,
            code: code
        })
        .then(() => {
            showAlert("✅ تم تسجيل الدفع لهذا الشهر");
        })
        .catch(() => {
            showAlert("❌ الكود غير صحيح");
            input.value = '';
        });
    }

    const monthKey = getCurrentMonthKey();

    db.ref('payments/' + monthKey).on('value', snapshot => {
        renderTable(snapshot.val() || {});
    });
</script>
